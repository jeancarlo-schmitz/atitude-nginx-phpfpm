#!/bin/bash
set -e

echo "ğŸ”» Parando e removendo containers..."
docker-compose down

echo "ğŸ§¹ Limpando containers parados..."
docker container prune -f

echo "ğŸ§¹ Removendo imagens antigas do nginx e php..."
docker image rm $(docker images | grep docker-ngix-phpfpm_nginx | awk '{print $3}') || true
docker image rm $(docker images | grep docker-ngix-phpfpm_php | awk '{print $3}') || true

echo "ğŸ”¨ Rebuild forÃ§ado de nginx e php..."
docker-compose build --no-cache nginx php

echo "ğŸš€ Subindo containers novamente..."
docker-compose up -d

echo "ğŸ› ï¸ Rodando composer install no container PHP..."
docker-compose run --rm php composer install --no-dev --optimize-autoloader

echo "âœ… Containers ativos:"
docker ps
